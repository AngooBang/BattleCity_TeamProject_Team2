function toggleNewspop(){typeof Storage!="undefined"&&document.getElementById("newpopstop").checked&&localStorage.setItem("planttext_message",news_version)}function LoadNews(){$.ajax({type:"GET",url:"api/news/"+news_version,success:function(n){$("#newsitem").html(n.content);openNewspop()},error:function(n,t,i){console.log("Status: "+t+" -- Error: "+i)}})}function LoadAllSamples(){$("#loader").show();$.ajax({type:"GET",url:"api/samples/",success:function(n){for(var u,f,i=$("#samples"),r=n[0].category,e=$(document.createElement("optgroup")).attr("value",r).attr("label",r).appendTo(i),t=0;t<n.length;t++)f=n[t].category,f===r?u=$(document.createElement("option")).attr("value",n[t].id).text(n[t].name).appendTo(i):(u=$(document.createElement("optgroup")).attr("value",n[t].id).attr("label",n[t].category).appendTo(i),u=$(document.createElement("option")).attr("value",n[t].id).text(n[t].name).appendTo(i)),r=n[t].category;$("#loader").hide()},error:function(n,t,i){console.log("Status: "+t+" -- Error: "+i);$("#loader").hide()}})}function saveFromButton(){$("#loader").show();typeof Storage!="undefined"&&(localStorage.setItem("planttext_layout",$("input[name='layout']:checked").val()),localStorage.setItem("planttext_fontsize",document.getElementById("fontsize").value),localStorage.setItem("planttext_indentguide",document.getElementById("indentguide").checked),localStorage.setItem("planttext_invisibles",document.getElementById("invisibles").checked),localStorage.setItem("planttext_keybinding",document.getElementById("keybinding").value),localStorage.setItem("planttext_plantumlserver",document.getElementById("plantumlserver").value==""?"default":document.getElementById("plantumlserver").value),localStorage.setItem("planttext_theme",document.getElementById("theme").value));$("#loader").hide();$("#fademessage").css("color","black").css("background-color","white").html("Your PlantUML and settings have been saved to the PlantText server. You can load them now from any computer.").fadeIn(1).fadeOut(5e3);$("#setting").dialog("close")}function toggleVisibles(){editor.getShowInvisibles()==!1?editor.setShowInvisibles(!0):editor.setShowInvisibles(!1)}function toggleIndentGuide(){editor.getDisplayIndentGuides()==!1?editor.setDisplayIndentGuides(!0):editor.setDisplayIndentGuides(!1)}function ptq(n){var u=n.replace(/;/g,"&").split("&"),i,t,r;for(n={},i=0;i<u.length;i++)r=u[i].split("=",2),t=unescape(r[0]),n[t]||(n[t]=[]),n[t][n[t].length]=r.length>1?unescape(r[1]):!0;return n}function param(){return ptq(location.search.substring(1).replace(/\+/g," "))}function entify(n){return(""+n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/>/g,"&gt;")}function refreshFromButton(){var t=document.getElementById("description").value,n;typeof Storage!="undefined"&&(n=localStorage.getItem("planttext_default"),n!=null&&n!=""&&localStorage.setItem(n,t));compress(t);$("#fademessage").css("color","black").css("background-color","white").html("The diagram is refreshing and your PlantUML has been saved to your computer's local storage.").fadeIn(1).fadeOut(5e3)}function defaultFromButton(){document.getElementById("plantumlserver").value="";$("#fademessage").css("color","black").css("background-color","white").html("The PlantUML server is now set to ... '"+document.getElementById("plantumlserver").value+"'.").fadeIn(1).fadeOut(5e3)}function urlFromPlantUML(){var n=document.getElementById("scriptingimagetype").value,t=document.getElementById("description").value;$("#loader").show();$.ajax({type:"POST",url:"api/scripting",timeout:5e3,data:{type:""+n+"",plantuml:""+t+""},success:function(t){var i=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/api/plantuml/"+n+"/"+t;document.getElementById("scriptingoutput").value=i},error:function(n,t,i){console.log("Status: "+t+" -- Error: "+i);$("#loader").hide()}});$("#loader").hide();$("#fademessage").css("color","black").css("background-color","white").html("Converting PlantUML to code stubs.").fadeIn(1).fadeOut(5e3)}function refreshFromSamples(n){editor.getSession().setValue(n);compress(document.getElementById("description").value);resizeEditor()}function resizeBrowser(){var n=$("#layout-landscape").attr("checked");n?landscape():portrait();$("#sidebar").height($(window).height()-sidebar_portrait_h_mod);resizeEditor()}function resizeEditor(){$("#editor").width($("#sidebar").width()-10);$("#editor").height($("#sidebar").height()-45);$("#scratch").height($(window).height()-sidebar_portrait_h_mod);$("#scratch").width(sidebar_portrait_w);editor.resize()}function openHelp(){$("#help").dialog("open")}function openSettings(){$("#setting").dialog("open")}function openScripting(){$("#scripting").dialog("open")}function openFiles(){$("#files").dialog("open")}function openNewspop(){$("#newspop").dialog("open")}function fileNameOutput(){var n=localStorage.getItem("planttext_default");$("#file-name-output").text(n.substring(18))}function openFileMenuNew(){$("#file-menu-new").dialog("open")}function submitFileMenuNew(){var t="",n=$("#file-menu-new-name").val().trim(),e=!1,u,f,r;for(i=0;i<window.localStorage.length;i++)if(u=window.localStorage.key(i),u.substring(0,18)==="planttext_diagram:"&&u.substring(18).trim()==n.trim()){e=!0;break}e?(t="This file name is already in use. Please try another name.",$("#file-menu-new-message").text(t)):n.trim()==""||n.length>=40?(t="Please enter a name that is fewer than 40 characters.",$("#file-menu-new-message").text(t)):n!=null&&(f="@startuml\r\rtitle Empty Diagram\r\r@enduml",r="planttext_diagram:"+n,localStorage.setItem("planttext_default",r),localStorage.setItem(r,f),fileNameOutput(r),refreshFromSamples(f),$("#file-menu-new").dialog("close"))}function submitFileMenuNewCancel(){$("#file-menu-new").dialog("close")}function openFileMenuOpen(){$("#file-menu-open").dialog("open")}function submitFileMenuOpen(){var t="",n=$("#file-menu-open-list").val(),r=localStorage.getItem("planttext_default"),i;n==null?(t="Please select a file to open or close this window.",$("#file-menu-open-message").text(t)):r==n?(t="You have selected the same file that is currently open.",$("#file-menu-open-message").text(t)):(i=localStorage.getItem(n),localStorage.setItem("planttext_default",n),localStorage.setItem(n,i),fileNameOutput(n),refreshFromSamples(i),$("#file-menu-open").dialog("close"))}function submitFileMenuOpenLoad(){var n,t;for($("#file-menu-open-list").html(""),i=0;i<window.localStorage.length;i++)n=localStorage.key(i),n.substring(0,18)==="planttext_diagram:"&&(t=localStorage.getItem(n),$("#file-menu-open-list").append('<option value="'+n+'">'+n.substring(18,n.length)+"<\/option>"))}function submitFileMenuOpenCancel(){$("#file-menu-open").dialog("close")}function submitFileMenuSave(){var n=localStorage.getItem("planttext_default"),t;n==""?alert("No file is currently loaded. Please use Save As to create a new file."):(t=$("#description").val(),typeof Storage!="undefined"?(n=localStorage.getItem("planttext_default"),localStorage.setItem(n,t),$("#fademessage").css("color","black").css("background-color","white").html("The diagram has been saved to your computer's local storage.").fadeIn(1).fadeOut(5e3)):alert("It appears you do not have a local storage capable browser or configuration. Please reolve before trying to use this application"))}function openFileMenuSaveas(){$("#file-menu-saveas").dialog("open")}function submitFileMenuSaveas(){var t="",n=$("#file-menu-saveas-name").val().trim(),e=!1,u,f,r;for(i=0;i<window.localStorage.length;i++)if(u=window.localStorage.key(i),u.substring(0,18)==="planttext_diagram:"&&u.substring(18).trim()==n.trim()){e=!0;break}e?(t="This file name is already in use. Please try another name.",$("#file-menu-saveas-message").text(t)):n.trim()==""||n.length>=40?(t="Please enter a name that is fewer than 40 characters.",$("#file-menu-saveas-message").text(t)):n!=null&&(f=document.getElementById("description").value,r="planttext_diagram:"+n,localStorage.setItem("planttext_default",r),localStorage.setItem(r,f),fileNameOutput(r),refreshFromSamples(f),$("#file-menu-saveas").dialog("close"))}function submitFileMenuSaveasCancel(){$("#file-menu-saveas").dialog("close")}function submitFileMenuDelete(){if(typeof Storage!="undefined"){var n=localStorage.getItem("planttext_default");n==""?alert("No file is currently loaded. Please open the file you wish to delete."):(localStorage.removeItem(n),localStorage.setItem("planttext_default",""),refreshFromSamples("@startuml\r\rtitle Empty Diagram\r\r@enduml"),$("#file-name-output").text(""))}}function openFileMenu(){document.getElementById("file-menu-list").classList.toggle("show")}function unDock(){var n=$(window).width()-($("#sidebar").width()+50);$("#sidebar").draggable();$("#sidebar").css({top:10});$("#sidebar").css({left:+n});$("#content").offset(sidebar_offset);resizeEditor();$("#fademessage").css("color","black").css("background-color","white").html("The editor is now in drag mode. You can move it around to any position on the screen.").fadeIn(1).fadeOut(5e3)}function doDock(){$("#sidebar").draggable("destroy");$("#sidebar").width(sidebar_portrait_w);$("#sidebar").height($(window).height()-sidebar_portrait_h_mod);$("#sidebar").offset(sidebar_offset);$("#sidebar").css({float:"left"});resizeEditor();$("#content").css({float:"left"});$("#content").offset(diagram_offset);$("#fademessage").css("color","black").css("background-color","white").html("The editor is now in dock mode. It will always be docked to the upper left and the diagram will to the right or below it.").fadeIn(1).fadeOut(5e3)}function portrait(){$("#sidebar").height($(window).height()-sidebar_portrait_h_mod);$("#sidebar").width(sidebar_portrait_w);resizeEditor()}function landscape(){$("#sidebar").height($(window).height()/sidebar_landscape_h_mod);$("#sidebar").width($(window).width()-sidebar_landscape_w_mod);resizeEditor()}function importUML(){var i=document.getElementById("fileInput"),t=i.files[0],n;return t.type.match(/text.*/)?(n=new FileReader,n.onload=function(){editor.getSession().setValue(n.result);compress(document.getElementById("description").value)},n.readAsText(t),resizeEditor()):alert("File not supported!"),!1}function exportUML(){return Download.save(editor.getSession().getValue(),"plantuml_export.txt"),!1}var news_version=17,sidebar_portrait_w=500,sidebar_portrait_h_mod=180,sidebar_landscape_w_mod=45,sidebar_landscape_h_mod=2,sidebar_offset={top:101,left:13},diagram_offset={top:101,left:535},warn_about_samples=!0,editor=ace.edit("editor"),textarea=$('textarea[name="description"]').hide(),Download;editor.getSession().setValue(textarea.val());editor.getSession().on("change",function(){textarea.val(editor.getSession().getValue())});document.getElementById("theme").onchange=function(){var n=this.options[this.selectedIndex].value;editor.setTheme("ace/theme/"+n)};document.getElementById("fontsize").onchange=function(){var n=this.options[this.selectedIndex].value;editor.setFontSize(n+"px");editor.resize()};document.getElementById("keybinding").onchange=function(){var n=this.options[this.selectedIndex].value;vla==""?editor.setKeyboardHandler("ace/keyboard/"):editor.setKeyboardHandler("ace/keyboard/"+n)};document.getElementById("samples").onchange=function(){var t=this.options[this.selectedIndex].value,n;t!="default"&&(n=!0,warn_about_samples&&(n=confirm('This will replace the PlantUML you have in your editor window. Press "Ok" to coninue or "Cancel" to abort.',"Samples"),warn_about_samples=!1),n&&($("#loader").show(),$.ajax({type:"GET",url:"api/samples/"+t,success:function(n){refreshFromSamples(n.content);$("#loader").hide()},error:function(n,t,i){console.log("Status: "+t+" -- Error: "+i);$("#loader").hide()}})))};window.onclick=function(n){var i,t,r;if(!n.target.matches("#file-menu-button"))for(i=document.getElementsByClassName("file-menu-dropdown-content"),t=0;t<i.length;t++)r=i[t],r.classList.contains("show")&&r.classList.remove("show")};Download={click:function(n){var t=document.createEvent("MouseEvents");return t.initMouseEvent("click",!0,!1,self,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(t)},encode:function(n){return"data:application/octet-stream;base64,"+btoa(n)},link:function(n,t){var i=document.createElement("a");return i.download=t||self.location.pathname.slice(self.location.pathname.lastIndexOf("/")+1),i.href=n||self.location.href,i}};Download.save=function(n,t){this.click(this.link(this.encode(n),t))};$(window).resize(resizeBrowser);resizeBrowser();$(document).keydown(function(n){n.keyCode==13&&n.altKey&&$("#refreshbutton").click()});$(document).ready(function(){var r,u,i,f,s,h,n,c,l,a,v,y,t,p,w,e,o;$("#file-menu-new").dialog({title:"New",width:350,autoOpen:!1,modal:!0,resizable:!1,draggable:!1,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500},open:function(){},close:function(){$("#file-menu-new-name").val("");$("#file-menu-new-message").text("")}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#file-menu-open").dialog({title:"Open",autoOpen:!1,modal:!0,resizable:!0,draggable:!1,width:500,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500},open:function(){submitFileMenuOpenLoad()},close:function(){$("file-menu-open-list").html("");$("#file-menu-open-message").text("")}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#file-menu-saveas").dialog({title:"Save As...",autoOpen:!1,modal:!0,resizable:!1,draggable:!1,width:300,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500},open:function(){},close:function(){$("#file-menu-saveas-name").val("");$("#file-menu-saveas-message").text("")}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#sidebar").resizable({resize:function(){resizeEditor()},minHeight:350,minWidth:420});$("#help").dialog({title:"Help",width:600,autoOpen:!1,modal:!1,resizable:!1,draggable:!0,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#setting").dialog({title:"Settings",width:500,autoOpen:!1,modal:!1,resizable:!1,draggable:!0,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#scripting").dialog({title:"Scripting",width:500,autoOpen:!1,modal:!1,resizable:!1,draggable:!0,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#files").dialog({title:"Import / Export",width:500,autoOpen:!1,modal:!1,resizable:!1,draggable:!0,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#newspop").dialog({title:"News",width:500,autoOpen:!1,modal:!0,resizable:!0,draggable:!0,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");r=!1;u="";q=param();for(k in q)entify(k)=="text"&&(r=!0,u=entify(q[k][0]));i=localStorage.getItem("plantuml_diagram");n=localStorage.getItem("planttext_default");i===null&&n===null?(localStorage.setItem("planttext_default","planttext_diagram:Default Diagram"),localStorage.setItem("planttext_diagram:Default Diagram","@startuml\r\rBob -> Alice: Hello!\r\r@enduml")):i!=null&&n===null?(localStorage.setItem("planttext_default","planttext_diagram:Default Diagram"),localStorage.setItem("planttext_diagram:Default Diagram",i),localStorage.removeItem("plantuml_diagram")):i===null&&n!=null;typeof Storage!="undefined"&&(f=localStorage.getItem("planttext_message"),f!=null&&(localStorage.setItem("planttext_message",f),localStorage.removeItem("plantuml_diagram")),s=localStorage.getItem("planttext_theme"),s==null&&(localStorage.setItem("planttext_layout","portrait"),localStorage.setItem("planttext_fontsize","12"),localStorage.setItem("planttext_indentguide",!0),localStorage.setItem("planttext_invisibles",!0),localStorage.setItem("planttext_keybinding","ace"),localStorage.setItem("planttext_plantumlserver","default"),localStorage.setItem("planttext_theme","textmate")));r?(h=decode64(u),refreshFromSamples(h)):typeof Storage!="undefined"?(n=localStorage.getItem("planttext_default"),n==""?editor.getSession().setValue("@startuml\r\rtitle Empty Diagram\r\r@enduml"):n!=null&&(c=localStorage.getItem(n),fileNameOutput(n),editor.getSession().setValue(c)),l=localStorage.getItem("planttext_layout"),l=="landscape"?($("#layout-landscape").attr("checked","checked"),landscape()):($("#layout-portrait").attr("checked","checked"),portrait()),a=localStorage.getItem("planttext_theme"),$("#theme option[value='"+a+"']").attr("selected",!0),t=document.getElementById("theme").options[document.getElementById("theme").selectedIndex].value,editor.setTheme("ace/theme/"+t),v=localStorage.getItem("planttext_fontsize"),$("#fontsize option[value='"+v+"']").attr("selected",!0),t=document.getElementById("fontsize").options[document.getElementById("fontsize").selectedIndex].value,editor.setFontSize(t+"px"),editor.resize(),y=localStorage.getItem("planttext_keybinding"),$("#keybinding option[value='"+y+"']").attr("selected",!0),t=document.getElementById("keybinding").options[document.getElementById("keybinding").selectedIndex].value,editor.setKeyboardHandler("ace/keyboard/"+t),p=localStorage.getItem("planttext_invisibles"),p=="true"?($("#invisibles").attr("checked","checked"),editor.setShowInvisibles(!0)):($("#invisibles").removeAttr("checked"),editor.setShowInvisibles(!1)),w=localStorage.getItem("planttext_indentguide"),w=="true"?($("#indentguide").attr("checked","checked"),editor.setDisplayIndentGuides(!0)):($("#indentguide").removeAttr("checked"),editor.setDisplayIndentGuides(!1)),e=localStorage.getItem("planttext_plantumlserver"),document.getElementById("plantumlserver").value=e=="default"?"":e):alert("It appears you do not have a local storage capable browser or configuration. Please resolve before trying to use this application");typeof Storage!="undefined"&&(o=localStorage.getItem("planttext_message"),(o===null||o!=news_version)&&LoadNews());compress(document.getElementById("description").value);LoadAllSamples();$("#loader").hide()});
